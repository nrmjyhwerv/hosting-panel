# DNS
# Name: @
# Type: A
# Value: YOUR_VPS_IP
# TTL: 300

# 2️⃣ Install Nginx and Certbot
sudo apt update
sudo apt install nginx python3-certbot-nginx -y

# 3️⃣ Allow HTTPS in Firewall
sudo ufw allow 'Nginx Full'
sudo ufw allow 3000
sudo ufw allow 25002

# 4️⃣ Create Nginx Reverse Proxy for Both Ports in ONE Config
sudo nano /etc/nginx/sites-available/hostcryptalis.conf

server {
    listen 80;
    server_name hostcryptalis.org;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /25002/ {
        proxy_pass http://127.0.0.1:25002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

# 5️⃣ Enable Config & Check Auto-Renew
sudo ln -s /etc/nginx/sites-available/hostcryptalis.conf /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl enable --now certbot.timer
sudo systemctl restart nginx

# 6️⃣ Get SSL Certificate
sudo certbot --nginx -d hostcryptalis.org

# 7️⃣ Access with HTTPS
# https://hostcryptalis.org/         → proxy to 3000
# https://hostcryptalis.org/25002/   → proxy to 25002
